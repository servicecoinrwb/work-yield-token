
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WorkYieldToken V2</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #000; color: #fff; font-family: Arial, sans-serif; padding: 2rem; }
    .container { max-width: 1000px; margin: auto; background: #111; padding: 2rem; border-radius: 10px; box-shadow: 0 0 10px #333; }
    h1 { color: #fca311; }
    .card { margin-top: 1rem; padding: 1rem; background: #222; border-radius: 8px; }
    input, button, select { margin-top: 10px; padding: 10px; border: none; border-radius: 6px; font-size: 1rem; }
    input, select { width: 100%; }
    button { background: #fca311; color: black; cursor: pointer; }
    .row { display: flex; gap: 10px; }
    .row button { flex: 1; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; text-align: left; border-bottom: 1px solid #444; }
    th { color: #fca311; }
    #walletBtn {
      position: absolute;
      top: 20px;
      right: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="text-align:right">
      <button onclick="connect()" id="walletBtn">🔌 Connect Wallet</button>
    </div>

    <h1>WorkYieldToken V2</h1>
    <p>Live smart contract dashboard</p>

    <div class="card">
      <p><strong>📦 Available WYT:</strong> <span id="availableTokens">...</span></p>
      <p><strong>💰 Contract pUSD:</strong> <span id="paymentBalance">...</span></p>
      <p><strong>🏦 Total Reserve:</strong> <span id="totalReserve">...</span></p>
      <p><strong>🧾 Redemption Fee:</strong> <span id="redemptionFee">...</span></p>
    </div>

    <div class="card" id="buyCard">
      <h3>Buy WYT</h3>
      <input id="buyAmount" placeholder="Amount (e.g. 1.00)" />
      <div class="row">
        <button onclick="setBuyMax()">Max</button>
        <button onclick="buyWYT()">Buy</button>
      </div>
    </div>

    <div class="card" id="redeemCard">
      <h3>Redeem WYT</h3>
      <input id="redeemAmount" placeholder="Amount (e.g. 1.00)" />
      <div class="row">
        <button onclick="setRedeemMax()">Max</button>
        <button onclick="redeemWYT()">Redeem</button>
      </div>
    </div>

    <div id="adminPanel" class="hidden">
      <div class="card">
        <h3>🧠 Mint Work Order</h3>
        <input id="mintYield" placeholder="Gross Yield (e.g. 100.00)" />
        <input id="mintDesc" placeholder="Description (e.g. 'Job #42')" />
        <button onclick="mintWorkOrder()">Mint</button>
      </div>

      <div class="card">
        <h3>🏦 Withdraw Fees</h3>
        <button onclick="withdrawFees()">Withdraw</button>
      </div>

      <div class="card">
        <h3>🧾 Set Redemption Fee</h3>
        <input id="newFee" placeholder="Fee % (max 20)" />
        <button onclick="setFee()">Set Fee</button>
      </div>

      <div class="card">
        <h3>❌ Cancel Work Order</h3>
        <input id="cancelId" placeholder="Work Order ID" />
        <button onclick="cancelWorkOrder()">Cancel</button>
      </div>
    </div>

    <div class="card">
      <h3>📋 Work Orders</h3>
      <button onclick="downloadCSV()">📤 Export CSV</button>
      <table id="ordersTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Yield</th>
            <th>Reserve</th>
            <th>Issued</th>
            <th>Status</th>
            <th>Date</th>
            <th>Desc</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h3>📈 Yield & Reserve Chart</h3>
      <canvas id="yieldChart" height="200"></canvas>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
